{"version":3,"sources":["System/Threading/Tasks/TaskHandlerBase.ts"],"names":[],"mappings":";;;;;;;;;;;;;;YAQA,oCAAoC;YAC9B,SAAS,GAAG,iBAAe,CAAC;YAE5B,IAAI,GAAG,iBAAiB,CAAC;YAC/B;;eAEG;YACH;gBAA8C,mCAAc;gBAI3D;oBAAA,YAEC,iBAAO,SAIP;oBAHA,KAAI,CAAC,qBAAqB,GAAG,IAAI,CAAC;oBAClC,KAAI,CAAC,UAAU,GAAG,IAAI,CAAC;oBACvB,KAAI,CAAC,OAAO,GAAG,eAAkB,CAAA;;gBAClC,CAAC;gBAID,sBAAI,wCAAW;yBAAf;wBAEC,MAAM,CAAC,CAAC,CAAC,IAAI,CAAC,UAAU,CAAC;oBAC1B,CAAC;;;mBAAA;gBAED;;;mBAGG;gBACH,+BAAK,GAAL,UAAM,KAAgB;oBAAhB,sBAAA,EAAA,SAAgB;oBAErB,IAAI,CAAC,eAAe,EAAE,CAAC;oBAEvB,IAAI,CAAC,MAAM,EAAE,CAAC;oBACd,IAAI,CAAC,OAAO,GAAG,oBAAuB,CAAC;oBACvC,EAAE,CAAA,CAAC,CAAC,CAAC,KAAK,GAAC,CAAC,CAAC,CAAC;wBAAC,KAAK,GAAG,CAAC,CAAC,CAAE,0CAA0C;oBACrE,EAAE,CAAA,CAAC,QAAQ,CAAM,KAAK,CAAC,CAAC;wBACvB,IAAI,CAAC,UAAU,GAAG,UAAU,CAAC,eAAe,CAAC,QAAQ,EAAE,KAAK,EAAE,IAAI,CAAC,CAAC;gBACtE,CAAC;gBAED,0CAAgB,GAAhB;oBAEC,IAAI,CAAC,eAAe,EAAE,CAAC;oBACvB,eAAe,CAAC,QAAQ,CAAC,IAAI,CAAC,CAAC;gBAChC,CAAC;gBAES,mCAAS,GAAnB;oBAEC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC;gBACrB,CAAC;gBAED,sBAAI,mCAAM;yBAAV;wBAEC,MAAM,CAAC,IAAI,CAAC,SAAS,EAAE,CAAC;oBACzB,CAAC;;;mBAAA;gBAED,4EAA4E;gBAC7D,wBAAQ,GAAvB,UAAwB,CAAiB;oBAExC,CAAC,CAAC,MAAM,EAAE,CAAC;oBACX,CAAC,CAAC,OAAO,GAAG,eAAkB,CAAC;oBAC/B,IACA,CAAC;wBACA,CAAC,CAAC,UAAU,EAAE,CAAC;wBACf,CAAC,CAAC,OAAO,GAAG,uBAA0B,CAAC;oBACxC,CAAC;oBACD,KAAK,CAAA,CAAC,EAAE,CAAC,CACT,CAAC;wBACA,CAAC,CAAC,OAAO,GAAG,eAAkB,CAAC;oBAChC,CAAC;gBACF,CAAC;gBAIS,oCAAU,GAApB;oBAEC,IAAI,CAAC,MAAM,EAAE,CAAC;oBACR,IAAK,CAAC,OAAO,GAAG,IAAI,CAAC;gBAC5B,CAAC;gBAED,gCAAM,GAAN;oBAEC,IAAM,EAAE,GAAG,IAAI,CAAC,UAAU,CAAC;oBAC3B,EAAE,CAAA,CAAC,EAAE,CAAC,CACN,CAAC;wBACA,YAAY,CAAC,EAAE,CAAC,CAAC;wBACjB,IAAI,CAAC,UAAU,GAAG,IAAI,CAAC;wBACvB,IAAI,CAAC,OAAO,GAAG,iBAAoB,CAAC;wBACpC,MAAM,CAAC,IAAI,CAAC;oBACb,CAAC;oBACD,MAAM,CAAC,KAAK,CAAC;gBACd,CAAC;gBAGF,sBAAC;YAAD,CAxFA,AAwFC,CAxF6C,+BAAc,GAwF3D;;iCAEc,eAAe;QAAC,CAAC","file":"TaskHandlerBase.js","sourcesContent":["/*!\r\n * @author electricessence / https://github.com/electricessence/\r\n * Licensing: MIT https://github.com/electricessence/TypeScript.NET/blob/master/LICENSE.md\r\n */\r\nimport {DisposableBase} from \"../../Disposable/DisposableBase\";\r\nimport {ICancellable} from \"../ICancellable\";\r\nimport {TaskStatus} from \"./TaskStatus\";\r\nimport __extendsImport from \"../../../extends\";\r\n// noinspection JSUnusedLocalSymbols\r\nconst __extends = __extendsImport;\r\n\r\nconst NAME = \"TaskHandlerBase\";\r\n/**\r\n * A simple class for handling potentially repeated executions either deferred or immediate.\r\n */\r\nexport abstract class TaskHandlerBase extends DisposableBase implements ICancellable\r\n{\r\n\tprivate _status:TaskStatus;\r\n\r\n\tconstructor()\r\n\t{\r\n\t\tsuper();\r\n\t\tthis._disposableObjectName = NAME;\r\n\t\tthis._timeoutId = null;\r\n\t\tthis._status = TaskStatus.Created\r\n\t}\r\n\r\n\tprivate _timeoutId:any;\r\n\r\n\tget isScheduled():boolean\r\n\t{\r\n\t\treturn !!this._timeoutId;\r\n\t}\r\n\r\n\t/**\r\n\t * Schedules/Reschedules triggering the task.\r\n\t * @param defer Optional time to wait until triggering.\r\n\t */\r\n\tstart(defer:number = 0):void\r\n\t{\r\n\t\tthis.throwIfDisposed();\r\n\r\n\t\tthis.cancel();\r\n\t\tthis._status = TaskStatus.WaitingToRun;\r\n\t\tif(!(defer>0)) defer = 0;  // A negation is used to catch edge cases.\r\n\t\tif(isFinite(<any>defer))\r\n\t\t\tthis._timeoutId = setTimeout(TaskHandlerBase._handler, defer, this);\r\n\t}\r\n\r\n\trunSynchronously():void\r\n\t{\r\n\t\tthis.throwIfDisposed();\r\n\t\tTaskHandlerBase._handler(this);\r\n\t}\r\n\r\n\tprotected getStatus():TaskStatus\r\n\t{\r\n\t\treturn this._status;\r\n\t}\r\n\r\n\tget status():TaskStatus\r\n\t{\r\n\t\treturn this.getStatus();\r\n\t}\r\n\r\n\t// Use a static function here to avoid recreating a new function every time.\r\n\tprivate static _handler(d:TaskHandlerBase):void\r\n\t{\r\n\t\td.cancel();\r\n\t\td._status = TaskStatus.Running;\r\n\t\ttry\r\n\t\t{\r\n\t\t\td._onExecute();\r\n\t\t\td._status = TaskStatus.RanToCompletion;\r\n\t\t}\r\n\t\tcatch(ex)\r\n\t\t{\r\n\t\t\td._status = TaskStatus.Faulted;\r\n\t\t}\r\n\t}\r\n\r\n\tprotected abstract _onExecute():void;\r\n\r\n\tprotected _onDispose():void\r\n\t{\r\n\t\tthis.cancel();\r\n\t\t(<any>this)._status = null;\r\n\t}\r\n\r\n\tcancel():boolean\r\n\t{\r\n\t\tconst id = this._timeoutId;\r\n\t\tif(id)\r\n\t\t{\r\n\t\t\tclearTimeout(id);\r\n\t\t\tthis._timeoutId = null;\r\n\t\t\tthis._status = TaskStatus.Cancelled;\r\n\t\t\treturn true;\r\n\t\t}\r\n\t\treturn false;\r\n\t}\r\n\r\n\r\n}\r\n\r\nexport default TaskHandlerBase;"]}